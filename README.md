# Apache-Security-Hardening
A step-by-step guide to hardening Apache web server on Linux.

## Audience
This is designed for linux system engineers, Apache admin, Middleware Administrator, Application Support, System Analyst, or anyone working or eager to learn Hardening & Security guidelines.
Fair knowledge of Apache Web Server & UNIX command is mandatory.

This Security hardening is for Red Hat/CentOS-based Systems or any system using httpd

You require some tool to examine HTTP Headers for some of the implementation verification. There are two ways to do this.

1. Use browser inbuilt developer tools to inspect the HTTP headers. Usually, it’s under Network tab
2. Use online HTTP response header checker tool
 
## Table of Contents

- [Checking the Apache version](#checking-the-apache-version)
- [Remove Server Version Banner](#remove-server-version-banner)
- [Security Hardening Directives](#security-hardening-directives)
- [HTTP Request Methods](#http-request-methods)
- [CORS Headers](#cors-headers)
- [Configuring TLS for Apache](#configuring-tls-for-apache)
- [Configuring Mod Security](#configuring-mod-security)
- [Disable Unnecessary Apache Modules](#disable-unnecessary-apache-modules)
- [Performance and Request Controls](#performance-and-request-controls)
- [Enable Apache Logging](#enable-apache-logging)


## checking the Apache version
On Red Hat-based systems, which use yum or dnf, run the following commands to check the running version of apache

- `httpd -v`

## Remove Server Version Banner

You don’t want to expose what web server version you are using. Exposing version means you are helping hacker to speedy the reconnaissance 
The default configuration will expose Apache Version and OS type. To change that go to the web httpd config folder /etc/httpd/conf

- Go to `/etc/httpd/conf` folder
- Modify `httpd.conf file` 
- Add the following directive and save the `httpd.conf`

ServerTokens Prod
ServerSignature Off

- Restart apache by runing the following command `systemctl restart httpd`

ServerSignature will remove the version information from the page generated by Apache. ServerTokens will change Header to production only, i.e., Apache

## Security Hardening Directives
Restricting access to sensitive directories is a critical security measure to prevent unauthorised users from viewing or interacting with files that should not be publicly accessible

# Denying Access to the Root Directory

To apply a default-deny policy to all directories except explicitly allowed locations

- Go to /etc/httpd/conf folder and edit the httpd.conf file and add
  
`<Directory />
    Require all denied
</Directory>`

# Blocking Access to Sensitive.

Certain files, such as .htaccess, .env, or database configuration files, should never be accessible via a web request. To prevent access, use the <Files>

`<Files ~ "^\.(htaccess|htpasswd|env|git|svn)">
    Require all denied
</Files>`

After making configuration changes, restart Apache to apply them by using the command `systemctl restart httpd`

# Disable Directory Listing
 This Prevents attackers from viewing directory contents if index.html is missing. To do that edit the `httpd.conf file` search for Directory and change Options directive to None or –Indexes

`<Directory /var/www/>
Options -Indexes
</Directory>`

Note: if you have multiple Directory directives in your environment, you should consider doing the same for all

# Etag
Etag allows remote attackers to obtain sensitive information like inode number, multipart MIME boundary, and child process through Etag header.
To prevent this vulnerability, implement it as below. 

- Go to /etc/httpd/conf folder and edit the httpd.conf file and add the following directive and save `the httpd.conf`

FileETag None

- Restart apache `systemctl restart httpd`

## HTTP Request Methods

HTTP 1.1 protocol support many request methods which may not be required and some of them are having potential risk.  Limit to only the methods needed by your application (usually GET, POST, HEAD, OPTIONS)

- Go to /etc/httpd/conf folder and edit the httpd.conf file and add

`<LimitExcept GET POST HEAD OPTIONS>
    Require all denied
</LimitExcept>`

# Disable Trace HTTP Request
By default Trace method is enabled in Apache web server. Having this enabled can allow Cross Site Tracing attack and potentially giving an option to a hacker to steal cookie information

- Go to /etc/httpd/conf folder and edit the `httpd.conf` file and add
  
  TraceEnable off
  
## CORS Headers
Cross Site Scripting (XSS) protection can be bypassed in many browsers. You could apply this protection for a web application if it was disabled by the user

- Go to /etc/httpd/conf folder and edit the `httpd.conf` file and add

  Header set X-XSS-Protection "1; mode=block"

  ## Configuring TLS for Apache
  
Having SSL/TLS is an additional layer of security you are adding into Web Application. It ensures secure communication with clients, configure Apache to use SSL/TLS by editing the SSL file.
The configuration file is, typically located at `/etc/httpd/conf.d/ssl.conf`

An example configuration for enabling HTTPS on Apache

<VirtualHost *:443>
    ServerAdmin example@domain.com
    DocumentRoot /var/www/html
    ServerName www.example.com

    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/example.com.crt
    SSLCertificateKeyFile /etc/ssl/private/example.com.key
    SSLCertificateChainFile /etc/ssl/certs/example.com-chain.crt

    <Directory /var/www/html>
        
    </Directory>

</VirtualHost>

- `SSLEngine on` enables SSL/TLS for the server.
- `SSLCertificateFile` specifies the path to your SSL certificate.
- `SSLCertificateKeyFile` points to the private key file.
- `SSLCertificateChainFile` is used for intermediate certificates, if applicable.

  ## Configuring Mod Security

  Mod Security is an open-source web application firewall, which you can use with Apache. It provides Web Application Firewall functionality to filter malicious requests.
  
- `dnf install mod_security`
  
- Enable it in Apache go to `httpd.conf file` and add

LoadModule security2_module modules/mod_security2.so
IncludeOptional /etc/httpd/modsecurity.d/*.conf

#  Enable mod_evasive (DoS/DDoS Protection)
Helps block repeated requests from the same IP

- dnf install mod_evasive
  
Example Config (/etc/httpd/conf.d/mod_evasive.conf):
<IfModule mod_evasive20.c>
    DOSHashTableSize    3097
    DOSPageCount        5
    DOSSiteCount        50
    DOSPageInterval     1
    DOSSiteInterval     1
    DOSBlockingPeriod   10
    DOSEmailNotify      admin@example.com
</IfModule>

## Disable Unnecessary Apache Modules

Every loaded module increases the attack surface to do that 

- `httpd -M`

- `vi /etc/httpd/conf.modules.d/*.conf`

Common modules to consider disabling:
- mod_autoindex (directory listings)
- mod_info (exposes config details)
- mod_status (shows server status to public)
- mod_userdir (exposes user home dirs)
- mod_cgi (if not using CGI)

## Performance and Request Controls

edit the `httpd.conf` file and add the following settings

KeepAlive On 
KeepAliveTimeout 60

- Purpose: Enables persistent connections. Improves performance for legitimate clients; timeout is slightly high.

LimitRequestBody 8096

- Purpose: Limits the size of request bodies. Helps prevent DoS attacks via large payloads.

LimitRequestFields 200 
LimitRequestFieldSize 28190 
LimitRequestLine 4094

- Purpose: Disables XML request bodies. Prevents XML bomb attacks like Billion Laughs.

LimitXMLRequestBody 0

- Purpose: Controls concurrency and resource usage

MaxKeepAliveRequests 500
MaxRequestWorkers 50 
TimeOut 300

- Helps mitigate resource exhaustion from slow or excessive clients.

RequestReadTimeout header=0 body=0

- Purpose: (Ineffective here) Sets read timeouts for headers and body. Importance: Meant to prevent slow HTTP attacks. But set to 0 = no timeout = security risk. Should be revised.

## Enable Apache Logging

Apache’s log files are useful for tracking and analysing web server activity, providing critical insight into potential security incidents. By enabling and properly configuring Apache log files, administrators can monitor traffic patterns, detect malicious activity, and investigate security breaches

- `vi /etc/httpd/conf/httpd.conf`  and aake sure the following two directives are present

ErrorLog logs/error_log
CustomLog logs/access_log combined

- ErrorLog → logs all Apache errors
- CustomLog → logs all HTTP requests (access logs)

- Make sure the Apache user can write to the log directory:
  
sudo chown -R apache:apache /var/log/httpd
